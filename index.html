
<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AMM PancakeV2 BSCå¤šç­¾æ“ä½œé¢æ¿ï¼ˆæ–°å¢Owner&Operatorå‡½æ•°ï¼‰</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/web3@1.10.0/dist/web3.min.js"></script>
    <style>
        .log-item {
            transition: all 0.3s ease;
        }
        .btn-disabled {
            cursor: not-allowed;
            opacity: 0.6;
        }
        .address-tag {
            background-color: #f0f9ff;
            color: #0284c7;
            padding: 2px 6px;
            border-radius: 4px;
            font-family: monospace;
            font-size: 12px;
        }
        .loading {
            cursor: wait;
            position: relative;
        }
        .loading::after {
            content: "";
            position: absolute;
            right: 10px;
            top: 50%;
            transform: translateY(-50%);
            width: 16px;
            height: 16px;
            border: 2px solid #fff;
            border-top: 2px solid transparent;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: translateY(-50%) rotate(0deg); }
            100% { transform: translateY(-50%) rotate(360deg); }
        }
        .network-switch-btn {
            background-color: #10b981;
            color: white;
            padding: 2px 8px;
            border-radius: 4px;
            font-size: 12px;
            cursor: pointer;
        }
        .permission-tag {
            background-color: #ffebee;
            color: #c62828;
            padding: 1px 4px;
            border-radius: 2px;
            font-size: 10px;
            font-weight: bold;
            margin-left: 4px;
        }
    </style>
</head>
<body class="bg-gray-50 min-h-screen p-4 md:p-8">
    <div class="max-w-5xl mx-auto bg-white rounded-xl shadow-md p-6 md:p-8">
        <h1 class="text-2xl md:text-3xl font-bold text-gray-800 mb-8 text-center">
            <span class="text-blue-600">BSCç½‘ç»œ</span> AutoMarketMaker_PancakeV2 å¤šç­¾æ“ä½œé¢æ¿
        </h1>

        <!-- 1. é’±åŒ…&ç½‘ç»œçŠ¶æ€åŒºåŸŸï¼ˆæ–°å¢Owneræ ‡è¯†ï¼‰ -->
        <div class="mb-8 p-4 border border-gray-200 rounded-lg bg-gray-50">
            <h2 class="text-xl font-semibold text-gray-700 mb-4">ğŸ“¡ é’±åŒ…ä¸ç½‘ç»œçŠ¶æ€</h2>
            <div class="flex flex-col md:flex-row items-center gap-4 flex-wrap">
                <p id="wallet-status" class="text-gray-600">é’±åŒ…çŠ¶æ€ï¼šæœªè¿æ¥</p>
                <p id="network-status" class="text-gray-600">
                    ç½‘ç»œçŠ¶æ€ï¼šæœªæ£€æµ‹
                    <span id="network-switch-btn" class="network-switch-btn hidden ml-2">ä¸€é”®åˆ‡æ¢BSCä¸»ç½‘</span>
                </p>
                <p id="current-account" class="text-gray-600 hidden">
                    å½“å‰è´¦æˆ·ï¼š<span class="address-tag"></span>
                    <span id="is-owner-tag" class="permission-tag hidden">OWNER</span>
                </p>
                <button id="connect-wallet" class="bg-blue-600 text-white px-6 py-2 rounded-lg hover:bg-blue-700 transition-colors">
                    è¿æ¥MetaMask
                </button>
            </div>
        </div>

        <!-- 2. åˆçº¦é…ç½®åŒºåŸŸï¼ˆåŸæœ‰é€»è¾‘ä¸å˜ï¼‰ -->
        <div class="mb-8 p-4 border border-gray-200 rounded-lg bg-gray-50">
            <h2 class="text-xl font-semibold text-gray-700 mb-4">ğŸ“ AMMåˆçº¦é…ç½®ï¼ˆå¿«é€Ÿé€‰æ‹©ï¼‰</h2>
            <div class="flex flex-col gap-4">
                <div>
                    <label for="amm-contract-select" class="block text-gray-600 mb-2">é€‰æ‹©é¢„è®¾AMMåˆçº¦</label>
                    <select id="amm-contract-select" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                        <option value="">-- è¯·é€‰æ‹©AMMåˆçº¦ --</option>
                        <option value="0x96C8C31101984628746e1dc2D788E74Be6b9b6A2">AMMåˆçº¦1ï¼š0x96C8C31101984628746e1dc2D788E74Be6b9b6A2</option>
                        <option value="0x635d5DD1587EC504b6900Ec294969C6FbB9bADB9">AMMåˆçº¦2ï¼š0x635d5DD1587EC504b6900Ec294969C6FbB9bADB9</option>
                        <option value="0x52D39Ae5c1745C85085D38C49Ee767B0a48817c8">AMMåˆçº¦3ï¼š0x52D39Ae5c1745C85085D38C49Ee767B0a48817c8</option>
                    </select>
                </div>
                <div>
                    <label for="contract-address" class="block text-gray-600 mb-2">AMMåˆçº¦åœ°å€ï¼ˆBSCç½‘ç»œï¼‰</label>
                    <input 
                        type="text" 
                        id="contract-address" 
                        class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
                        placeholder="è¯·è¾“å…¥AutoMarketMaker_PancakeV2åˆçº¦åœ°å€ï¼ˆ0x...ï¼‰"
                    >
                </div>
                <button id="init-contract" class="bg-gray-700 text-white px-6 py-2 rounded-lg hover:bg-gray-800 transition-colors w-full md:w-auto self-start">
                    åˆå§‹åŒ–åˆçº¦
                </button>
            </div>
        </div>

        <!-- 3. å¤šç­¾ä¿¡æ¯æŸ¥è¯¢åŒºåŸŸï¼ˆåŸæœ‰é€»è¾‘ä¸å˜ï¼Œæ–°å¢OwneræŸ¥è¯¢ï¼‰ -->
        <div class="mb-8 p-4 border border-gray-200 rounded-lg bg-gray-50">
            <h2 class="text-xl font-semibold text-gray-700 mb-4">ğŸ” å¤šç­¾ä¿¡æ¯æŸ¥è¯¢</h2>
            <button id="query-multisig-info" class="bg-green-600 text-white px-6 py-2 rounded-lg hover:bg-green-700 transition-colors mb-4" disabled>
                æŸ¥è¯¢å¤šç­¾ä¿¡æ¯
            </button>

            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                <div>
                    <p class="text-gray-600 mb-1">å½“å‰ç¡®è®¤æ•°ï¼š</p>
                    <p id="confirm-count" class="font-mono text-xl text-gray-800">--</p>
                </div>
                <div>
                    <p class="text-gray-600 mb-1">æ˜¯å¦å·²æˆæƒä¿®æ”¹ï¼š</p>
                    <p id="is-authorized" class="font-mono text-xl text-gray-800">--</p>
                </div>
                <div>
                    <p class="text-gray-600 mb-1">å½“å‰è´¦æˆ·æ˜¯å¦ä¸ºå¤šç­¾ï¼š</p>
                    <p id="is-multisigner" class="font-mono text-xl text-gray-800">--</p>
                </div>
                <div>
                    <p class="text-gray-600 mb-1">æ‰€éœ€æœ€å°ç¡®è®¤æ•°ï¼š</p>
                    <p id="required-confirms" class="font-mono text-xl text-gray-800">3</p>
                </div>
                <div class="md:col-span-2">
                    <p class="text-gray-600 mb-1">åˆçº¦Owneråœ°å€ï¼š</p>
                    <p id="contract-owner" class="font-mono text-xl text-gray-800">--</p>
                </div>
            </div>

            <div class="mb-2">
                <p class="text-gray-600 mb-2">å¤šç­¾åœ°å€åˆ—è¡¨ï¼š</p>
                <div id="multisig-list" class="max-h-40 overflow-y-auto p-2 border border-gray-300 rounded-lg bg-white">
                    <p class="text-gray-500 text-center">æœªæŸ¥è¯¢åˆ°å¤šç­¾åˆ—è¡¨</p>
                </div>
            </div>
        </div>

        <!-- 4. æ ¸å¿ƒæ“ä½œåŒºåŸŸï¼ˆåŸæœ‰é€»è¾‘ä¸å˜ï¼‰ -->
        <div class="mb-8 p-4 border border-gray-200 rounded-lg bg-gray-50">
            <h2 class="text-xl font-semibold text-gray-700 mb-4">âš¡ å¤šç­¾æ ¸å¿ƒæ“ä½œ</h2>
            <div class="flex flex-col md:flex-row gap-4">
                <button id="confirm-modify" class="bg-purple-600 text-white px-6 py-2 rounded-lg hover:bg-purple-700 transition-colors disabled:btn-disabled" disabled>
                    ç¡®è®¤ä¿®æ”¹æˆæƒï¼ˆconfirmModifyï¼‰
                </button>
                <button id="reset-authorization" class="bg-orange-600 text-white px-6 py-2 rounded-lg hover:bg-orange-700 transition-colors disabled:btn-disabled" disabled>
                    é‡ç½®æˆæƒçŠ¶æ€ï¼ˆresetModifyAuthorizationï¼‰
                </button>
            </div>
        </div>

        <!-- 5. æ–°å¢ï¼šOwnerä¸“å±æ“ä½œåŒºåŸŸ -->
        <div class="mb-8 p-4 border border-red-200 rounded-lg bg-red-50">
            <h2 class="text-xl font-semibold text-red-700 mb-4">ğŸ” Ownerä¸“å±æ“ä½œï¼ˆä»…åˆçº¦ç®¡ç†å‘˜å¯ç”¨ï¼‰</h2>
            <p id="owner-tip" class="text-red-600 mb-4 text-sm">âš ï¸  å½“å‰è´¦æˆ·éåˆçº¦Ownerï¼Œæ‰€æœ‰æ“ä½œæŒ‰é’®ä¸å¯ç”¨</p>

            <!-- 5.1 setConfigAddress æ“ä½œ -->
            <div class="mb-6 p-3 border border-red-100 rounded-lg bg-white">
                <h3 class="text-lg font-medium text-red-700 mb-3">è®¾ç½®é…ç½®åœ°å€ï¼ˆsetConfigAddressï¼‰</h3>
                <div class="flex flex-col gap-3">
                    <div>
                        <label for="config-type" class="block text-gray-600 mb-1">åœ°å€ç±»å‹</label>
                        <select id="config-type" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-red-500">
                            <option value="farm">farm</option>
                            <option value="oneclick">oneclick</option>
                            <option value="release">release</option>
                            <option value="lprewardburn">lprewardburn</option>
                        </select>
                    </div>
                    <div>
                        <label for="new-config-address" class="block text-gray-600 mb-1">æ–°åœ°å€</label>
                        <input type="text" id="new-config-address" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-red-500" placeholder="0x...">
                    </div>
                    <button id="set-config-address" class="bg-red-600 text-white px-4 py-2 rounded-lg hover:bg-red-700 transition-colors disabled:btn-disabled" disabled>
                        æäº¤è®¾ç½®
                    </button>
                </div>
            </div>

            <!-- 5.2 updateTradingParams æ“ä½œ -->
            <div class="mb-6 p-3 border border-red-100 rounded-lg bg-white">
                <h3 class="text-lg font-medium text-red-700 mb-3">æ›´æ–°äº¤æ˜“å‚æ•°ï¼ˆupdateTradingParamsï¼‰</h3>
                <div class="flex flex-col gap-3">
                    <div>
                        <label for="swap-slippage" class="block text-gray-600 mb-1">æ»‘ç‚¹æ¯”ä¾‹ï¼ˆä¸‡åˆ†ä¹‹å‡ ï¼Œæœ€å¤§10000ï¼‰</label>
                        <input type="number" id="swap-slippage" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-red-500" placeholder="10000" min="0" max="10000">
                    </div>
                    <div>
                        <label for="deadline-gap" class="block text-gray-600 mb-1">æˆªæ­¢æ—¶é—´åç§»ï¼ˆç§’ï¼Œæœ€å¤§86400ï¼‰</label>
                        <input type="number" id="deadline-gap" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-red-500" placeholder="300" min="0" max="86400">
                    </div>
                    <button id="update-trading-params" class="bg-red-600 text-white px-4 py-2 rounded-lg hover:bg-red-700 transition-colors disabled:btn-disabled" disabled>
                        æäº¤æ›´æ–°
                    </button>
                </div>
            </div>

            <!-- 5.3 addOperator æ“ä½œ -->
            <div class="mb-6 p-3 border border-red-100 rounded-lg bg-white">
                <h3 class="text-lg font-medium text-red-700 mb-3">æ·»åŠ Operatorï¼ˆaddOperatorï¼‰</h3>
                <div class="flex flex-col gap-3">
                    <div>
                        <label for="operator-address" class="block text-gray-600 mb-1">Operatoråœ°å€</label>
                        <input type="text" id="operator-address" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-red-500" placeholder="0x...">
                    </div>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-3">
                        <div>
                            <label for="max-swap-amount" class="block text-gray-600 mb-1">æœ€å¤§Swapé‡‘é¢</label>
                            <input type="text" id="max-swap-amount" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-red-500" placeholder="1000000000000000000">
                        </div>
                        <div>
                            <label for="max-add-liq-token" class="block text-gray-600 mb-1">æœ€å¤§æ·»åŠ æµåŠ¨æ€§Tokené‡‘é¢</label>
                            <input type="text" id="max-add-liq-token" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-red-500" placeholder="1000000000000000000">
                        </div>
                        <div>
                            <label for="max-add-liq-usdt" class="block text-gray-600 mb-1">æœ€å¤§æ·»åŠ æµåŠ¨æ€§USDTé‡‘é¢</label>
                            <input type="text" id="max-add-liq-usdt" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-red-500" placeholder="1000000000000000000">
                        </div>
                        <div>
                            <label for="max-remove-liq" class="block text-gray-600 mb-1">æœ€å¤§ç§»é™¤æµåŠ¨æ€§é‡‘é¢</label>
                            <input type="text" id="max-remove-liq" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-red-500" placeholder="1000000000000000000">
                        </div>
                    </div>
                    <button id="add-operator" class="bg-red-600 text-white px-4 py-2 rounded-lg hover:bg-red-700 transition-colors disabled:btn-disabled" disabled>
                        æ·»åŠ Operator
                    </button>
                </div>
            </div>

            <!-- 5.4 removeOperator æ“ä½œ -->
            <div class="mb-6 p-3 border border-red-100 rounded-lg bg-white">
                <h3 class="text-lg font-medium text-red-700 mb-3">ç§»é™¤Operatorï¼ˆremoveOperatorï¼‰</h3>
                <div class="flex flex-col gap-3">
                    <div>
                        <label for="remove-operator-address" class="block text-gray-600 mb-1">Operatoråœ°å€</label>
                        <input type="text" id="remove-operator-address" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-red-500" placeholder="0x...">
                    </div>
                    <button id="remove-operator" class="bg-red-600 text-white px-4 py-2 rounded-lg hover:bg-red-700 transition-colors disabled:btn-disabled" disabled>
                        ç§»é™¤Operator
                    </button>
                </div>
            </div>

            <!-- 5.5 setOperatorLimits æ“ä½œ -->
            <div class="mb-6 p-3 border border-red-100 rounded-lg bg-white">
                <h3 class="text-lg font-medium text-red-700 mb-3">è®¾ç½®Operatoré™é¢ï¼ˆsetOperatorLimitsï¼‰</h3>
                <div class="flex flex-col gap-3">
                    <div>
                        <label for="set-limits-operator-address" class="block text-gray-600 mb-1">Operatoråœ°å€</label>
                        <input type="text" id="set-limits-operator-address" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-red-500" placeholder="0x...">
                    </div>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-3">
                        <div>
                            <label for="new-max-swap" class="block text-gray-600 mb-1">æ–°æœ€å¤§Swapé‡‘é¢</label>
                            <input type="text" id="new-max-swap" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-red-500" placeholder="1000000000000000000">
                        </div>
                        <div>
                            <label for="new-max-add-liq-token" class="block text-gray-600 mb-1">æ–°æœ€å¤§æ·»åŠ æµåŠ¨æ€§Tokené‡‘é¢</label>
                            <input type="text" id="new-max-add-liq-token" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-red-500" placeholder="1000000000000000000">
                        </div>
                        <div>
                            <label for="new-max-add-liq-usdt" class="block text-gray-600 mb-1">æ–°æœ€å¤§æ·»åŠ æµåŠ¨æ€§USDTé‡‘é¢</label>
                            <input type="text" id="new-max-add-liq-usdt" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-red-500" placeholder="1000000000000000000">
                        </div>
                        <div>
                            <label for="new-max-remove-liq" class="block text-gray-600 mb-1">æ–°æœ€å¤§ç§»é™¤æµåŠ¨æ€§é‡‘é¢</label>
                            <input type="text" id="new-max-remove-liq" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-red-500" placeholder="1000000000000000000">
                        </div>
                    </div>
                    <div>
                        <label for="operator-is-active" class="block text-gray-600 mb-1">æ˜¯å¦æ¿€æ´»</label>
                        <select id="operator-is-active" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-red-500">
                            <option value="true">æ˜¯</option>
                            <option value="false">å¦</option>
                        </select>
                    </div>
                    <button id="set-operator-limits" class="bg-red-600 text-white px-4 py-2 rounded-lg hover:bg-red-700 transition-colors disabled:btn-disabled" disabled>
                        è®¾ç½®Operatoré™é¢
                    </button>
                </div>
            </div>
        </div>

        <!-- 6. æ–°å¢ï¼šOperatorä¸“å±æ“ä½œåŒºåŸŸ -->
        <div class="mb-8 p-4 border border-blue-200 rounded-lg bg-blue-50">
            <h2 class="text-xl font-semibold text-blue-700 mb-4">ğŸ› ï¸ Operatorä¸“å±æ“ä½œï¼ˆä»…æ´»è·ƒOperatorå¯ç”¨ï¼‰</h2>
            <p id="operator-tip" class="text-blue-600 mb-4 text-sm">âš ï¸  å½“å‰è´¦æˆ·éæ´»è·ƒOperatorï¼Œæ‰€æœ‰æ“ä½œæŒ‰é’®ä¸å¯ç”¨</p>

            <!-- 6.1 autoSwap æ“ä½œ -->
            <div class="mb-6 p-3 border border-blue-100 rounded-lg bg-white">
                <h3 class="text-lg font-medium text-blue-700 mb-3">è‡ªåŠ¨å…‘æ¢ï¼ˆautoSwapï¼‰</h3>
                <div class="flex flex-col gap-3">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-3">
                        <div>
                            <label for="from-token" class="block text-gray-600 mb-1">è½¬å‡ºä»£å¸åœ°å€</label>
                            <input type="text" id="from-token" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="0x...">
                        </div>
                        <div>
                            <label for="to-token" class="block text-gray-600 mb-1">è½¬å…¥ä»£å¸åœ°å€</label>
                            <input type="text" id="to-token" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="0x...">
                        </div>
                        <div>
                            <label for="swap-amount-in" class="block text-gray-600 mb-1">è½¬å‡ºé‡‘é¢</label>
                            <input type="text" id="swap-amount-in" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="1000000000000000000">
                        </div>
                        <div>
                            <label for="swap-amount-out-min" class="block text-gray-600 mb-1">æœ€å°è½¬å…¥é‡‘é¢ï¼ˆç•™ç©ºè‡ªåŠ¨è®¡ç®—ï¼‰</label>
                            <input type="text" id="swap-amount-out-min" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="0">
                        </div>
                    </div>
                    <button id="auto-swap" class="bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition-colors disabled:btn-disabled" disabled>
                        æ‰§è¡Œå…‘æ¢
                    </button>
                </div>
            </div>

            <!-- 6.2 autoAddLiquidity æ“ä½œ -->
            <div class="mb-6 p-3 border border-blue-100 rounded-lg bg-white">
                <h3 class="text-lg font-medium text-blue-700 mb-3">è‡ªåŠ¨æ·»åŠ æµåŠ¨æ€§ï¼ˆautoAddLiquidityï¼‰</h3>
                <div class="flex flex-col gap-3">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-3">
                        <div>
                            <label for="liq-token-amount" class="block text-gray-600 mb-1">TokenæœŸæœ›é‡‘é¢</label>
                            <input type="text" id="liq-token-amount" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="1000000000000000000">
                        </div>
                        <div>
                            <label for="liq-usdt-amount" class="block text-gray-600 mb-1">USDTæœŸæœ›é‡‘é¢</label>
                            <input type="text" id="liq-usdt-amount" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="1000000000000000000">
                        </div>
                        <div>
                            <label for="liq-token-min" class="block text-gray-600 mb-1">Tokenæœ€å°é‡‘é¢ï¼ˆç•™ç©ºè‡ªåŠ¨è®¡ç®—ï¼‰</label>
                            <input type="text" id="liq-token-min" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="0">
                        </div>
                        <div>
                            <label for="liq-usdt-min" class="block text-gray-600 mb-1">USDTæœ€å°é‡‘é¢ï¼ˆç•™ç©ºè‡ªåŠ¨è®¡ç®—ï¼‰</label>
                            <input type="text" id="liq-usdt-min" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="0">
                        </div>
                    </div>
                    <button id="auto-add-liquidity" class="bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition-colors disabled:btn-disabled" disabled>
                        æ·»åŠ æµåŠ¨æ€§
                    </button>
                </div>
            </div>

            <!-- 6.3 autoRemoveLiquidity æ“ä½œ -->
            <div class="mb-6 p-3 border border-blue-100 rounded-lg bg-white">
                <h3 class="text-lg font-medium text-blue-700 mb-3">è‡ªåŠ¨ç§»é™¤æµåŠ¨æ€§ï¼ˆautoRemoveLiquidityï¼‰</h3>
                <div class="flex flex-col gap-3">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-3">
                        <div>
                            <label for="remove-liq-amount" class="block text-gray-600 mb-1">LPä»£å¸é‡‘é¢</label>
                            <input type="text" id="remove-liq-amount" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="1000000000000000000">
                        </div>
                        <div>
                            <label for="remove-token-min" class="block text-gray-600 mb-1">Tokenæœ€å°é‡‘é¢ï¼ˆç•™ç©ºå¡«1ï¼‰</label>
                            <input type="text" id="remove-token-min" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="1">
                        </div>
                        <div class="md:col-span-2">
                            <label for="remove-usdt-min" class="block text-gray-600 mb-1">USDTæœ€å°é‡‘é¢ï¼ˆç•™ç©ºå¡«1ï¼‰</label>
                            <input type="text" id="remove-usdt-min" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="1">
                        </div>
                    </div>
                    <button id="auto-remove-liquidity" class="bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition-colors disabled:btn-disabled" disabled>
                        ç§»é™¤æµåŠ¨æ€§
                    </button>
                </div>
            </div>

            <!-- 6.4 transferFunds æ“ä½œï¼ˆæ–°å¢ä½™é¢å±•ç¤ºï¼‰ -->
            <div class="mb-6 p-3 border border-blue-100 rounded-lg bg-white">
                <h3 class="text-lg font-medium text-blue-700 mb-3">è½¬è´¦èµ„é‡‘ï¼ˆtransferFundsï¼‰</h3>
                <div class="flex flex-col gap-3">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-3">
                        <div>
                            <label for="transfer-token" class="block text-gray-600 mb-1">ä»£å¸åœ°å€</label>
                            <input type="text" id="transfer-token" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="0x...">
                            <!-- æ–°å¢ï¼šåˆçº¦ä»£å¸ä½™é¢å±•ç¤º -->
                            <p id="contract-token-balance" class="mt-1 text-sm">
                                <span class="text-gray-500">åˆçº¦è¯¥ä»£å¸ä½™é¢ï¼š</span>
                                <span class="text-blue-600 font-mono" id="balance-display">--</span>
                                <span id="balance-loading" class="text-gray-400 text-xs hidden">ï¼ˆæŸ¥è¯¢ä¸­...ï¼‰</span>
                                <span id="balance-error" class="text-red-500 text-xs hidden">ï¼ˆåœ°å€æ— æ•ˆ/æŸ¥è¯¢å¤±è´¥ï¼‰</span>
                            </p>
                        </div>
                        <div>
                            <label for="transfer-recipient" class="block text-gray-600 mb-1">æ¥æ”¶åœ°å€ï¼ˆä»…é¢„è®¾åœ°å€ï¼‰</label>
                            <input type="text" id="transfer-recipient" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="0x...">
                        </div>
                        <div class="md:col-span-2">
                            <label for="transfer-amount" class="block text-gray-600 mb-1">è½¬è´¦é‡‘é¢</label>
                            <input type="text" id="transfer-amount" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="1000000000000000000">
                        </div>
                    </div>
                    <button id="transfer-funds" class="bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition-colors disabled:btn-disabled" disabled>
                        æ‰§è¡Œè½¬è´¦
                    </button>
                </div>
            </div>
        </div>

        <!-- 7. æ“ä½œæ—¥å¿—åŒºåŸŸï¼ˆåŸæœ‰é€»è¾‘ä¸å˜ï¼‰ -->
        <div class="mb-4 p-4 border border-gray-200 rounded-lg bg-gray-50">
            <h2 class="text-xl font-semibold text-gray-700 mb-4">ğŸ“œ æ“ä½œæ—¥å¿—</h2>
            <div id="operation-logs" class="max-h-60 overflow-y-auto p-2 border border-gray-300 rounded-lg bg-white">
                <p class="text-gray-500 text-center">æš‚æ— æ“ä½œè®°å½•</p>
            </div>
        </div>
    </div>

    <script>
        // å…¨å±€å˜é‡
        let web3 = null;
        let accounts = [];
        let ammContract = null;
        let currentIsOwner = false; // æ–°å¢ï¼šå½“å‰è´¦æˆ·æ˜¯å¦ä¸ºOwner
        let currentIsActiveOperator = false; // æ–°å¢ï¼šå½“å‰è´¦æˆ·æ˜¯å¦ä¸ºæ´»è·ƒOperator
        // BSCç½‘ç»œé…ç½®ï¼ˆä¸»ç½‘ï¼‰
        const BSC_MAINNET = {
            chainId: '0x38', // 56 åè¿›åˆ¶
            chainName: 'Binance Smart Chain Mainnet',
            nativeCurrency: {
                name: 'BNB',
                symbol: 'BNB',
                decimals: 18
            },
            rpcUrls: ['https://bsc-dataseed1.binance.org/'],
            blockExplorerUrls: ['https://bscscan.com/']
        };
        const BSC_TESTNET_CHAIN_ID = '0x38'; // 56 åè¿›åˆ¶
        const REQUIRED_CONFIRMS = 3;
        const MULTI_SIGNER_NUM = 5;

        // å®Œæ•´ABIï¼ˆæ–°å¢æ‰€æœ‰å‡½æ•°å®šä¹‰ï¼Œä¸åˆçº¦ä¸€è‡´ï¼‰
        const AMM_ABI = [
            // åŸæœ‰åªè¯»å‡½æ•°
            {
                "inputs": [],
                "name": "getAllMultiSigners",
                "outputs": [{"internalType": "address[]", "name": "", "type": "address[]"}],
                "stateMutability": "view",
                "type": "function"
            },
            {
                "inputs": [],
                "name": "modifyConfirmCount",
                "outputs": [{"internalType": "uint256", "name": "", "type": "uint256"}],
                "stateMutability": "view",
                "type": "function"
            },
            {
                "inputs": [],
                "name": "isModifyAuthorized",
                "outputs": [{"internalType": "bool", "name": "", "type": "bool"}],
                "stateMutability": "view",
                "type": "function"
            },
            {
                "inputs": [{"internalType": "address", "name": "", "type": "address"}],
                "name": "isMultiSigner",
                "outputs": [{"internalType": "bool", "name": "", "type": "bool"}],
                "stateMutability": "view",
                "type": "function"
            },
            {
                "inputs": [],
                "name": "REQUIRED_CONFIRMS",
                "outputs": [{"internalType": "uint256", "name": "", "type": "uint256"}],
                "stateMutability": "view",
                "type": "function"
            },
            {
                "inputs": [{"internalType": "address", "name": "", "type": "address"}],
                "name": "modifyConfirmed",
                "outputs": [{"internalType": "bool", "name": "", "type": "bool"}],
                "stateMutability": "view",
                "type": "function"
            },
            // åŸæœ‰å†™å‡½æ•°
            {
                "inputs": [],
                "name": "confirmModify",
                "outputs": [],
                "stateMutability": "nonpayable",
                "type": "function"
            },
            {
                "inputs": [],
                "name": "resetModifyAuthorization",
                "outputs": [],
                "stateMutability": "nonpayable",
                "type": "function"
            },
            // æ–°å¢ï¼šåªè¯»å‡½æ•°ï¼ˆOwner/OperatoræŸ¥è¯¢ï¼‰
            {
                "inputs": [],
                "name": "owner",
                "outputs": [{"internalType": "address", "name": "", "type": "address"}],
                "stateMutability": "view",
                "type": "function"
            },
            {
                "inputs": [{"internalType": "address", "name": "", "type": "address"}],
                "name": "isOperator",
                "outputs": [{"internalType": "bool", "name": "", "type": "bool"}],
                "stateMutability": "view",
                "type": "function"
            },
            {
                "inputs": [{"internalType": "address", "name": "", "type": "address"}],
                "name": "operatorLimits",
                "outputs": [
                    {"internalType": "uint256", "name": "maxSwapAmount", "type": "uint256"},
                    {"internalType": "uint256", "name": "maxAddLiquidityTokenAmount", "type": "uint256"},
                    {"internalType": "uint256", "name": "maxAddLiquidityUsdtAmount", "type": "uint256"},
                    {"internalType": "uint256", "name": "maxRemoveLiquidityAmount", "type": "uint256"},
                    {"internalType": "bool", "name": "isActive", "type": "bool"}
                ],
                "stateMutability": "view",
                "type": "function"
            },
            {
                "inputs": [],
                "name": "swapSlippage",
                "outputs": [{"internalType": "uint256", "name": "", "type": "uint256"}],
                "stateMutability": "view",
                "type": "function"
            },
            {
                "inputs": [],
                "name": "deadlineGap",
                "outputs": [{"internalType": "uint256", "name": "", "type": "uint256"}],
                "stateMutability": "view",
                "type": "function"
            },
            {
                "inputs": [],
                "name": "token",
                "outputs": [{"internalType": "address", "name": "", "type": "address"}],
                "stateMutability": "view",
                "type": "function"
            },
            {
                "inputs": [],
                "name": "usdt",
                "outputs": [{"internalType": "address", "name": "", "type": "address"}],
                "stateMutability": "view",
                "type": "function"
            },
            {
                "inputs": [],
                "name": "lpToken",
                "outputs": [{"internalType": "address", "name": "", "type": "address"}],
                "stateMutability": "view",
                "type": "function"
            },
            // æ–°å¢ï¼šOwnerä¸“å±å†™å‡½æ•°
            {
                "inputs": [
                    {"internalType": "string", "name": "_typeName", "type": "string"},
                    {"internalType": "address", "name": "_newAddress", "type": "address"}
                ],
                "name": "setConfigAddress",
                "outputs": [],
                "stateMutability": "nonpayable",
                "type": "function"
            },
            {
                "inputs": [
                    {"internalType": "uint256", "name": "_swapSlippage", "type": "uint256"},
                    {"internalType": "uint256", "name": "_deadlineGap", "type": "uint256"}
                ],
                "name": "updateTradingParams",
                "outputs": [],
                "stateMutability": "nonpayable",
                "type": "function"
            },
            {
                "inputs": [
                    {"internalType": "address", "name": "_operator", "type": "address"},
                    {"internalType": "uint256", "name": "_maxSwapAmount", "type": "uint256"},
                    {"internalType": "uint256", "name": "_maxAddLiquidityTokenAmount", "type": "uint256"},
                    {"internalType": "uint256", "name": "_maxAddLiquidityUsdtAmount", "type": "uint256"},
                    {"internalType": "uint256", "name": "_maxRemoveLiquidityAmount", "type": "uint256"}
                ],
                "name": "addOperator",
                "outputs": [],
                "stateMutability": "nonpayable",
                "type": "function"
            },
            {
                "inputs": [{"internalType": "address", "name": "_operator", "type": "address"}],
                "name": "removeOperator",
                "outputs": [],
                "stateMutability": "nonpayable",
                "type": "function"
            },
            {
                "inputs": [
                    {"internalType": "address", "name": "_operator", "type": "address"},
                    {"internalType": "uint256", "name": "_maxSwapAmount", "type": "uint256"},
                    {"internalType": "uint256", "name": "_maxAddLiquidityTokenAmount", "type": "uint256"},
                    {"internalType": "uint256", "name": "_maxAddLiquidityUsdtAmount", "type": "uint256"},
                    {"internalType": "uint256", "name": "_maxRemoveLiquidityAmount", "type": "uint256"},
                    {"internalType": "bool", "name": "_isActive", "type": "bool"}
                ],
                "name": "setOperatorLimits",
                "outputs": [],
                "stateMutability": "nonpayable",
                "type": "function"
            },
            // æ–°å¢ï¼šOperatorä¸“å±å†™å‡½æ•°
            {
                "inputs": [
                    {"internalType": "address", "name": "_fromToken", "type": "address"},
                    {"internalType": "address", "name": "_toToken", "type": "address"},
                    {"internalType": "uint256", "name": "_amountIn", "type": "uint256"},
                    {"internalType": "uint256", "name": "_minAmountOut", "type": "uint256"}
                ],
                "name": "autoSwap",
                "outputs": [],
                "stateMutability": "nonpayable",
                "type": "function"
            },
            {
                "inputs": [
                    {"internalType": "uint256", "name": "_tokenAmountDesired", "type": "uint256"},
                    {"internalType": "uint256", "name": "_usdtAmountDesired", "type": "uint256"},
                    {"internalType": "uint256", "name": "_minTokenAmount", "type": "uint256"},
                    {"internalType": "uint256", "name": "_minUsdtAmount", "type": "uint256"}
                ],
                "name": "autoAddLiquidity",
                "outputs": [],
                "stateMutability": "nonpayable",
                "type": "function"
            },
            {
                "inputs": [
                    {"internalType": "uint256", "name": "_liquidity", "type": "uint256"},
                    {"internalType": "uint256", "name": "_minTokenAmount", "type": "uint256"},
                    {"internalType": "uint256", "name": "_minUsdtAmount", "type": "uint256"}
                ],
                "name": "autoRemoveLiquidity",
                "outputs": [],
                "stateMutability": "nonpayable",
                "type": "function"
            },
            {
                "inputs": [
                    {"internalType": "address", "name": "_token", "type": "address"},
                    {"internalType": "address", "name": "_recipient", "type": "address"},
                    {"internalType": "uint256", "name": "_amount", "type": "uint256"}
                ],
                "name": "transferFunds",
                "outputs": [],
                "stateMutability": "nonpayable",
                "type": "function"
            }
        ];

        // å·¥å…·å‡½æ•°ï¼šæ·»åŠ æ“ä½œæ—¥å¿—ï¼ˆåŸæœ‰é€»è¾‘ä¸å˜ï¼‰
        function addLog(content, isSuccess = true) {
            const logContainer = document.getElementById('operation-logs');
            const emptyTip = logContainer.querySelector('.text-gray-500.text-center');
            if (emptyTip) {
                emptyTip.remove();
            }

            const logItem = document.createElement('div');
            logItem.className = `log-item p-2 border-b border-gray-200 ${isSuccess ? 'text-green-700' : 'text-red-700'}`;
            logItem.innerHTML = `<span class="font-mono text-sm">${new Date().toLocaleString()}</span>ï¼š${content}`;
            
            logContainer.prepend(logItem);
            console.log(`${isSuccess ? '[æˆåŠŸ]' : '[å¤±è´¥]'} ${new Date().toLocaleString()}ï¼š${content}`);
        }

        // å·¥å…·å‡½æ•°ï¼šæ ¼å¼åŒ–åœ°å€ï¼ˆåŸæœ‰é€»è¾‘ä¸å˜ï¼‰
        function formatAddress(address) {
            if (!address || address.length !== 42) return address;
            return `${address.slice(0, 6)}...${address.slice(-4)}`;
        }

        // å·¥å…·å‡½æ•°ï¼šç®€åŒ–BSCç½‘ç»œæ£€æµ‹ï¼ˆåŸæœ‰é€»è¾‘ä¸å˜ï¼‰
        async function checkBSCNetwork() {
            if (!web3) {
                addLog('æœªåˆå§‹åŒ–Web3ï¼Œæ— æ³•æ£€æµ‹ç½‘ç»œ', false);
                return false;
            }
            try {
                const chainId = await web3.eth.getChainId();
                const switchBtn = document.getElementById('network-switch-btn');

                if (chainId === 56) {
                    document.getElementById('network-status').textContent = 'ç½‘ç»œçŠ¶æ€ï¼šBSCä¸»ç½‘ï¼ˆå·²é€‚é…ï¼‰';
                    document.getElementById('network-status').className = 'text-green-600';
                    if (switchBtn) switchBtn.classList.add('hidden');
                    return true;
                } else {
                    document.getElementById('network-status').innerHTML = `
                        ç½‘ç»œçŠ¶æ€ï¼šéBSCä¸»ç½‘ï¼ˆå½“å‰ChainIdï¼š${chainId}ï¼‰
                        <span id="network-switch-btn" class="network-switch-btn ml-2">ä¸€é”®åˆ‡æ¢BSCä¸»ç½‘</span>
                    `;
                    document.getElementById('network-status').className = 'text-red-600';
                    const switchBtnDom = document.getElementById('network-switch-btn');
                    if (switchBtnDom) {
                        switchBtnDom.removeEventListener('click', switchToBSCMainnet);
                        switchBtnDom.addEventListener('click', switchToBSCMainnet);
                    }
                    addLog(`å½“å‰ç½‘ç»œéBSCä¸»ç½‘ï¼ˆChainIdï¼š${chainId}ï¼‰ï¼Œå¯ç‚¹å‡»ã€Œä¸€é”®åˆ‡æ¢BSCä¸»ç½‘ã€`, false);
                    return false;
                }
            } catch (error) {
                addLog(`æ£€æµ‹ç½‘ç»œå¤±è´¥ï¼š${error.message}`, false);
                console.error('ç½‘ç»œæ£€æµ‹é”™è¯¯ï¼š', error);
                return false;
            }
        }

        // å‡½æ•°ï¼šä¸€é”®åˆ‡æ¢åˆ°BSCä¸»ç½‘ï¼ˆåŸæœ‰é€»è¾‘ä¸å˜ï¼‰
        async function switchToBSCMainnet() {
            try {
                if (!window.ethereum) {
                    throw new Error('æœªæ£€æµ‹åˆ°MetaMaské’±åŒ…');
                }
                addLog('æ­£åœ¨è¯·æ±‚åˆ‡æ¢åˆ°BSCä¸»ç½‘ï¼Œè¯·åœ¨é’±åŒ…ä¸­ç¡®è®¤');
                await window.ethereum.request({
                    method: 'wallet_switchEthereumChain',
                    params: [{ chainId: BSC_MAINNET.chainId }],
                });
                addLog('æˆåŠŸåˆ‡æ¢åˆ°BSCä¸»ç½‘');
                setTimeout(async () => {
                    await checkBSCNetwork();
                }, 1000);
            } catch (switchError) {
                if (switchError.code === 4902) {
                    try {
                        addLog('BSCä¸»ç½‘æœªæ·»åŠ åˆ°é’±åŒ…ï¼Œæ­£åœ¨è¯·æ±‚æ·»åŠ ');
                        await window.ethereum.request({
                            method: 'wallet_addEthereumChain',
                            params: [BSC_MAINNET],
                        });
                        addLog('æˆåŠŸæ·»åŠ å¹¶åˆ‡æ¢åˆ°BSCä¸»ç½‘');
                        setTimeout(async () => {
                            await checkBSCNetwork();
                        }, 1000);
                    } catch (addError) {
                        addLog(`æ·»åŠ BSCä¸»ç½‘å¤±è´¥ï¼š${addError.message}`, false);
                    }
                } else {
                    addLog(`åˆ‡æ¢BSCä¸»ç½‘å¤±è´¥ï¼š${switchError.message}`, false);
                }
            }
        }

        // æ–°å¢å·¥å…·å‡½æ•°ï¼šæ›´æ–°æƒé™çŠ¶æ€ï¼ˆOwner/Operatorï¼‰
        async function updatePermissionStatus() {
            if (!web3 || !ammContract || !accounts.length) {
                currentIsOwner = false;
                currentIsActiveOperator = false;
                updatePermissionUI();
                return;
            }

            const currentAccount = accounts[0].toLowerCase();
            try {
                // 1. æŸ¥è¯¢Ownerå¹¶åˆ¤æ–­
                const contractOwner = (await ammContract.methods.owner().call()).toLowerCase();
                currentIsOwner = (currentAccount === contractOwner);

                // 2. æŸ¥è¯¢OperatorçŠ¶æ€å¹¶åˆ¤æ–­
                const isOperator = await ammContract.methods.isOperator(currentAccount).call();
                let isActive = false;
                if (isOperator) {
                    const operatorLimits = await ammContract.methods.operatorLimits(currentAccount).call();
                    isActive = operatorLimits.isActive;
                }
                currentIsActiveOperator = isOperator && isActive;

                // 3. æ›´æ–°åˆçº¦Owneræ˜¾ç¤º
                document.getElementById('contract-owner').textContent = formatAddress(contractOwner);
                document.getElementById('contract-owner').title = contractOwner;

                addLog(`æƒé™æ ¡éªŒå®Œæˆï¼šå½“å‰è´¦æˆ·${currentIsOwner ? 'æ˜¯' : 'ä¸æ˜¯'}Ownerï¼Œ${currentIsActiveOperator ? 'æ˜¯' : 'ä¸æ˜¯'}æ´»è·ƒOperator`, true);
            } catch (error) {
                addLog(`æƒé™æ ¡éªŒå¤±è´¥ï¼š${error.message}`, false);
                currentIsOwner = false;
                currentIsActiveOperator = false;
            } finally {
                updatePermissionUI();
            }
        }

        // æ–°å¢å·¥å…·å‡½æ•°ï¼šæ›´æ–°æƒé™ç›¸å…³UI
        function updatePermissionUI() {
            // 1. Ownerç›¸å…³UI
            const isOwnerTag = document.getElementById('is-owner-tag');
            const ownerTip = document.getElementById('owner-tip');
            const ownerButtons = [
                document.getElementById('set-config-address'),
                document.getElementById('update-trading-params'),
                document.getElementById('add-operator'),
                document.getElementById('remove-operator'),
                document.getElementById('set-operator-limits')
            ];

            if (currentIsOwner) {
                isOwnerTag.classList.remove('hidden');
                ownerTip.innerHTML = 'âœ… å½“å‰è´¦æˆ·æ˜¯åˆçº¦Ownerï¼Œå¯æ‰§è¡Œä»¥ä¸‹æ“ä½œï¼ˆéœ€å…ˆå®Œæˆ3ä¸ªå¤šç­¾æˆæƒï¼‰';
                ownerTip.className = 'text-green-600 mb-4 text-sm';
                ownerButtons.forEach(btn => {
                    if (ammContract) {
                        btn.removeAttribute('disabled');
                    } else {
                        btn.setAttribute('disabled', true);
                    }
                });
            } else {
                isOwnerTag.classList.add('hidden');
                ownerTip.innerHTML = 'âš ï¸ å½“å‰è´¦æˆ·éåˆçº¦Ownerï¼Œæ‰€æœ‰æ“ä½œæŒ‰é’®ä¸å¯ç”¨';
                ownerTip.className = 'text-red-600 mb-4 text-sm';
                ownerButtons.forEach(btn => btn.setAttribute('disabled', true));
            }

            // 2. Operatorç›¸å…³UI
            const operatorTip = document.getElementById('operator-tip');
            const operatorButtons = [
                document.getElementById('auto-swap'),
                document.getElementById('auto-add-liquidity'),
                document.getElementById('auto-remove-liquidity'),
                document.getElementById('transfer-funds')
            ];

            if (currentIsActiveOperator) {
                operatorTip.innerHTML = 'âœ… å½“å‰è´¦æˆ·æ˜¯æ´»è·ƒOperatorï¼Œå¯æ‰§è¡Œä»¥ä¸‹æ“ä½œ';
                operatorTip.className = 'text-green-600 mb-4 text-sm';
                operatorButtons.forEach(btn => {
                    if (ammContract) {
                        btn.removeAttribute('disabled');
                    } else {
                        btn.setAttribute('disabled', true);
                    }
                });
            } else {
                operatorTip.innerHTML = 'âš ï¸ å½“å‰è´¦æˆ·éæ´»è·ƒOperatorï¼Œæ‰€æœ‰æ“ä½œæŒ‰é’®ä¸å¯ç”¨';
                operatorTip.className = 'text-blue-600 mb-4 text-sm';
                operatorButtons.forEach(btn => btn.setAttribute('disabled', true));
            }
        }

        // æ–°å¢å·¥å…·å‡½æ•°ï¼šè·å–ä»£å¸å°æ•°ä½æ•°ï¼ˆå¤„ç†BNBå’ŒERC20ä»£å¸ï¼‰
        async function getTokenDecimals(tokenAddress) {
            if (!web3 || !web3.utils.isAddress(tokenAddress)) {
                return 18; // é»˜è®¤è¿”å›18ä½ï¼Œå¼‚å¸¸æƒ…å†µå…œåº•
            }
            // åŸç”ŸBNBï¼ˆé›¶åœ°å€ï¼‰
            if (tokenAddress.toLowerCase() === '0x0000000000000000000000000000000000000000') {
                return 18;
            }
            // ERC20ä»£å¸æŸ¥è¯¢decimals
            try {
                const erc20Abi = [{
                    "inputs": [],
                    "name": "decimals",
                    "outputs": [{"internalType": "uint8", "name": "", "type": "uint8"}],
                    "stateMutability": "view",
                    "type": "function"
                }];
                const erc20Contract = new web3.eth.Contract(erc20Abi, tokenAddress);
                const decimals = await erc20Contract.methods.decimals().call();
                return decimals;
            } catch (error) {
                console.warn(`è·å–ä»£å¸${tokenAddress}å°æ•°ä½æ•°å¤±è´¥ï¼Œé»˜è®¤ä½¿ç”¨18ä½ï¼š`, error);
                return 18;
            }
        }

        // æ ¸å¿ƒå‡½æ•°ï¼šæŸ¥è¯¢åˆçº¦å¯¹åº”ä»£å¸ä½™é¢å¹¶æ˜¾ç¤º
        async function queryContractTokenBalance() {
            // è·å–DOMå…ƒç´ 
            const tokenInput = document.getElementById('transfer-token');
            const balanceDisplay = document.getElementById('balance-display');
            const balanceLoading = document.getElementById('balance-loading');
            const balanceError = document.getElementById('balance-error');
            const tokenAddress = tokenInput.value.trim();

            // é‡ç½®æ˜¾ç¤ºçŠ¶æ€
            balanceDisplay.textContent = '--';
            balanceLoading.classList.remove('hidden');
            balanceError.classList.add('hidden');

            // å‰ç½®æ ¡éªŒ
            if (!web3) {
                balanceDisplay.textContent = '--';
                balanceLoading.classList.add('hidden');
                balanceError.textContent = 'ï¼ˆè¯·å…ˆè¿æ¥é’±åŒ…ï¼‰';
                balanceError.classList.remove('hidden');
                return;
            }
            if (!ammContract) {
                balanceDisplay.textContent = '--';
                balanceLoading.classList.add('hidden');
                balanceError.textContent = 'ï¼ˆè¯·å…ˆåˆå§‹åŒ–åˆçº¦ï¼‰';
                balanceError.classList.remove('hidden');
                return;
            }
            if (!tokenAddress || !web3.utils.isAddress(tokenAddress)) {
                balanceDisplay.textContent = '--';
                balanceLoading.classList.add('hidden');
                if (tokenAddress) { // è¾“å…¥éç©ºä½†æ— æ•ˆåœ°å€
                    balanceError.textContent = 'ï¼ˆæ— æ•ˆçš„ä»£å¸åœ°å€ï¼‰';
                    balanceError.classList.remove('hidden');
                } else { // è¾“å…¥ä¸ºç©º
                    balanceError.classList.add('hidden');
                }
                return;
            }

            try {
                let contractBalanceRaw; // åŸå§‹ä½™é¢ï¼ˆæœ€å°å•ä½ï¼‰
                const contractAddr = ammContract.options.address;
                const decimals = await getTokenDecimals(tokenAddress);

                // åŒºåˆ†åŸç”ŸBNBå’ŒERC20ä»£å¸
                if (tokenAddress.toLowerCase() === '0x0000000000000000000000000000000000000000') {
                    // æŸ¥è¯¢åˆçº¦BNBä½™é¢
                    contractBalanceRaw = await web3.eth.getBalance(contractAddr);
                } else {
                    // æŸ¥è¯¢ERC20ä»£å¸åˆçº¦ä½™é¢
                    const erc20Abi = [{
                        "inputs": [{"internalType": "address", "name": "account", "type": "address"}],
                        "name": "balanceOf",
                        "outputs": [{"internalType": "uint256", "name": "", "type": "uint256"}],
                        "stateMutability": "view",
                        "type": "function"
                    }];
                    const erc20Contract = new web3.eth.Contract(erc20Abi, tokenAddress);
                    contractBalanceRaw = await erc20Contract.methods.balanceOf(contractAddr).call();
                }

                // æ ¼å¼åŒ–ä½™é¢ï¼ˆè½¬æ¢ä¸ºäººç±»å¯è¯»æ ¼å¼ï¼Œå¦‚1 BNB = 10^18 weiï¼‰
                const formattedBalance = web3.utils.fromWei(contractBalanceRaw, decimals === 18 ? 'ether' : 'wei');
                // ä¿ç•™6ä½å°æ•°ï¼Œé¿å…è¿‡é•¿
                const displayBalance = Number(formattedBalance).toFixed(6);

                // æ›´æ–°æ˜¾ç¤º
                balanceDisplay.textContent = `${displayBalance}ï¼ˆåŸå§‹ï¼š${contractBalanceRaw}ï¼‰`;
                balanceLoading.classList.add('hidden');
                balanceError.classList.add('hidden');
            } catch (error) {
                console.error(`æŸ¥è¯¢åˆçº¦ä»£å¸ä½™é¢å¤±è´¥ï¼š`, error);
                balanceDisplay.textContent = '--';
                balanceLoading.classList.add('hidden');
                balanceError.textContent = `ï¼ˆæŸ¥è¯¢å¤±è´¥ï¼š${error.message.slice(0, 20)}...ï¼‰`;
                balanceError.classList.remove('hidden');
            }
        }

        // ===== DOMåŠ è½½å®Œæˆåç»‘å®šäº‹ä»¶ =====
        document.addEventListener('DOMContentLoaded', async function() {
            addLog('é¡µé¢DOMåŠ è½½å®Œæˆï¼Œå¼€å§‹åˆå§‹åŒ–äº‹ä»¶ç»‘å®š');

            // 1. ä¸‹æ‹‰æ¡†é€‰æ‹©åŒæ­¥åˆ°è¾“å…¥æ¡†ï¼ˆåŸæœ‰é€»è¾‘ä¸å˜ï¼‰
            document.getElementById('amm-contract-select').addEventListener('change', function() {
                const selectedAddress = this.value;
                document.getElementById('contract-address').value = selectedAddress;
                if (selectedAddress) {
                    addLog(`å·²é€‰æ‹©é¢„è®¾AMMåˆçº¦ï¼š${formatAddress(selectedAddress)}ï¼ˆå®Œæ•´åœ°å€ï¼š${selectedAddress}ï¼‰`);
                }
            });

            // 2. é’±åŒ…è¿æ¥é€»è¾‘ï¼ˆæ–°å¢æƒé™æ›´æ–°ï¼‰
            document.getElementById('connect-wallet').addEventListener('click', async () => {
                try {
                    if (typeof window.ethereum === 'undefined') {
                        throw new Error('æœªæ£€æµ‹åˆ°MetaMaské’±åŒ…ï¼Œè¯·å…ˆå®‰è£…å¹¶å¯ç”¨');
                    }
                    let tempWeb3 = new Web3(window.ethereum);
                    let tempAccounts;
                    try {
                        tempAccounts = await tempWeb3.eth.getAccounts();
                    } catch (e) {
                        throw new Error('é’±åŒ…å·²é”å®šï¼Œè¯·å…ˆè§£é”MetaMask');
                    }
                    if (tempAccounts.length === 0) {
                        tempAccounts = await window.ethereum.request({
                            method: 'eth_requestAccounts',
                            params: []
                        });
                    }

                    web3 = tempWeb3;
                    accounts = tempAccounts;
                    const currentAccount = accounts[0];

                    document.getElementById('wallet-status').textContent = 'é’±åŒ…çŠ¶æ€ï¼šå·²è¿æ¥';
                    document.getElementById('wallet-status').className = 'text-green-600';
                    document.getElementById('current-account').classList.remove('hidden');
                    document.getElementById('current-account').querySelector('.address-tag').textContent = formatAddress(currentAccount);
                    document.getElementById('current-account').querySelector('.address-tag').title = currentAccount;
                    document.getElementById('connect-wallet').textContent = 'é‡æ–°è¿æ¥é’±åŒ…';

                    await checkBSCNetwork();
                    // æ–°å¢ï¼šæ›´æ–°æƒé™çŠ¶æ€
                    if (ammContract) {
                        await updatePermissionStatus();
                    }
                    addLog(`é’±åŒ…è¿æ¥æˆåŠŸï¼Œå½“å‰è´¦æˆ·ï¼š${formatAddress(currentAccount)}ï¼ˆå®Œæ•´åœ°å€ï¼š${currentAccount}ï¼‰`);
                } catch (error) {
                    addLog(`é’±åŒ…è¿æ¥å¤±è´¥ï¼š${error.message}`, false);
                    console.error('é’±åŒ…è¿æ¥é”™è¯¯ï¼š', error);
                }
            });

            // 3. ç›‘å¬é’±åŒ…è´¦æˆ·åˆ‡æ¢ï¼ˆæ–°å¢æƒé™æ›´æ–°ï¼‰
            if (window.ethereum) {
                window.ethereum.on('accountsChanged', async (newAccounts) => {
                    accounts = newAccounts;
                    if (newAccounts.length === 0) {
                        document.getElementById('wallet-status').textContent = 'é’±åŒ…çŠ¶æ€ï¼šå·²æ–­å¼€';
                        document.getElementById('wallet-status').className = 'text-gray-600';
                        document.getElementById('current-account').classList.add('hidden');
                        currentIsOwner = false;
                        currentIsActiveOperator = false;
                        updatePermissionUI();
                        addLog('é’±åŒ…è´¦æˆ·å·²ç§»é™¤ï¼Œè¿æ¥æ–­å¼€', false);
                        return;
                    }
                    const currentAccount = newAccounts[0];
                    document.getElementById('current-account').querySelector('.address-tag').textContent = formatAddress(currentAccount);
                    document.getElementById('current-account').querySelector('.address-tag').title = currentAccount;
                    addLog(`é’±åŒ…è´¦æˆ·å·²åˆ‡æ¢ï¼š${formatAddress(currentAccount)}ï¼ˆå®Œæ•´åœ°å€ï¼š${currentAccount}ï¼‰`);
                    await checkBSCNetwork();
                    // æ–°å¢ï¼šæ›´æ–°æƒé™çŠ¶æ€
                    if (ammContract) {
                        await updatePermissionStatus();
                    }
                });

                // 4. ç›‘å¬ç½‘ç»œåˆ‡æ¢ï¼ˆåŸæœ‰é€»è¾‘ä¸å˜ï¼‰
                window.ethereum.on('chainChanged', async (newChainId) => {
                    addLog(`ç½‘ç»œå·²åˆ‡æ¢ï¼Œæ–°ChainIdï¼š${web3.utils.hexToNumber(newChainId)}`);
                    await checkBSCNetwork();
                });
            }

            // 5. åˆå§‹åŒ–åˆçº¦é€»è¾‘ï¼ˆæ–°å¢æƒé™æ›´æ–°ï¼‰
            document.getElementById('init-contract').addEventListener('click', async () => {
                try {
                    if (!web3) {
                        throw new Error('è¯·å…ˆè¿æ¥é’±åŒ…');
                    }
                    const isBSC = await checkBSCNetwork();
                    if (!isBSC) {
                        throw new Error('å½“å‰éBSCç½‘ç»œï¼Œæ— æ³•åˆå§‹åŒ–åˆçº¦');
                    }
                    const contractAddress = document.getElementById('contract-address').value.trim();
                    if (!contractAddress || !web3.utils.isAddress(contractAddress)) {
                        throw new Error('è¯·è¾“å…¥æœ‰æ•ˆçš„åˆçº¦åœ°å€ï¼ˆæˆ–ä»ä¸‹æ‹‰æ¡†é€‰æ‹©é¢„è®¾åœ°å€ï¼‰');
                    }

                    ammContract = new web3.eth.Contract(AMM_ABI, contractAddress);
                    addLog(`åˆçº¦åˆå§‹åŒ–æˆåŠŸï¼š${formatAddress(contractAddress)}ï¼ˆBSCç½‘ç»œï¼‰`);
                    document.getElementById('query-multisig-info').removeAttribute('disabled');
                    // æ–°å¢ï¼šæ›´æ–°æƒé™çŠ¶æ€
                    await updatePermissionStatus();
                } catch (error) {
                    addLog(`åˆçº¦åˆå§‹åŒ–å¤±è´¥ï¼š${error.message}`, false);
                    console.error('åˆçº¦åˆå§‹åŒ–é”™è¯¯ï¼š', error);
                }
            });

            // 6. æŸ¥è¯¢å¤šç­¾ä¿¡æ¯é€»è¾‘ï¼ˆæ–°å¢OwneræŸ¥è¯¢å’Œæƒé™æ›´æ–°ï¼‰
            document.getElementById('query-multisig-info').addEventListener('click', async function() {
                const btn = this;
                btn.classList.add('loading');
                btn.setAttribute('disabled', true);

                try {
                    // å¼ºæ ¡éªŒæ‰€æœ‰å‰ç½®æ¡ä»¶
                    if (!web3) {
                        throw new Error('Web3æœªåˆå§‹åŒ–ï¼Œè¯·å…ˆè¿æ¥é’±åŒ…');
                    }
                    if (!ammContract) {
                        throw new Error('åˆçº¦æœªåˆå§‹åŒ–ï¼Œè¯·å…ˆç‚¹å‡»ã€Œåˆå§‹åŒ–åˆçº¦ã€');
                    }
                    if (!accounts || accounts.length === 0) {
                        throw new Error('æœªè·å–åˆ°è´¦æˆ·ï¼Œè¯·é‡æ–°è¿æ¥é’±åŒ…');
                    }
                    const isBSC = await checkBSCNetwork();
                    if (!isBSC) {
                        throw new Error('å½“å‰éBSCä¸»ç½‘ï¼Œæ— æ³•æŸ¥è¯¢å¤šç­¾ä¿¡æ¯');
                    }
                    const currentAccount = accounts[0];
                    addLog(`å¼€å§‹æŸ¥è¯¢å¤šç­¾ä¿¡æ¯ï¼Œå½“å‰è´¦æˆ·ï¼š${formatAddress(currentAccount)}`);

                    // åˆ†æ­¥è°ƒç”¨åˆçº¦å‡½æ•°ï¼Œå•ç‹¬æ•è·é”™è¯¯
                    let multiSigners = [];
                    let confirmCount = 0;
                    let isAuthorized = false;
                    let isMultisigner = false;

                    // æŸ¥è¯¢å¤šç­¾åœ°å€åˆ—è¡¨
                    try {
                        multiSigners = await ammContract.methods.getAllMultiSigners().call();
                        addLog(`å¤šç­¾åœ°å€åˆ—è¡¨æŸ¥è¯¢æˆåŠŸï¼Œå…±${multiSigners.length}ä¸ªå¤šç­¾åœ°å€`, true);
                    } catch (err) {
                        throw new Error(`æŸ¥è¯¢å¤šç­¾åœ°å€åˆ—è¡¨å¤±è´¥ï¼š${err.message}`);
                    }

                    // æŸ¥è¯¢å½“å‰ç¡®è®¤æ•°
                    try {
                        confirmCount = await ammContract.methods.modifyConfirmCount().call();
                        addLog(`å½“å‰ç¡®è®¤æ•°æŸ¥è¯¢æˆåŠŸï¼š${confirmCount}`, true);
                    } catch (err) {
                        throw new Error(`æŸ¥è¯¢å½“å‰ç¡®è®¤æ•°å¤±è´¥ï¼š${err.message}`);
                    }

                    // æŸ¥è¯¢æ˜¯å¦å·²æˆæƒä¿®æ”¹
                    try {
                        isAuthorized = await ammContract.methods.isModifyAuthorized().call();
                        addLog(`æ˜¯å¦å·²æˆæƒä¿®æ”¹æŸ¥è¯¢æˆåŠŸï¼š${isAuthorized ? 'æ˜¯' : 'å¦'}`, true);
                    } catch (err) {
                        throw new Error(`æŸ¥è¯¢æ˜¯å¦å·²æˆæƒä¿®æ”¹å¤±è´¥ï¼š${err.message}`);
                    }

                    // æŸ¥è¯¢å½“å‰è´¦æˆ·æ˜¯å¦ä¸ºå¤šç­¾
                    try {
                        isMultisigner = await ammContract.methods.isMultiSigner(currentAccount).call();
                        addLog(`å½“å‰è´¦æˆ·å¤šç­¾èº«ä»½æŸ¥è¯¢æˆåŠŸï¼š${isMultisigner ? 'æ˜¯å¤šç­¾è´¦æˆ·' : 'éå¤šç­¾è´¦æˆ·'}`, true);
                    } catch (err) {
                        throw new Error(`æŸ¥è¯¢å½“å‰è´¦æˆ·å¤šç­¾èº«ä»½å¤±è´¥ï¼š${err.message}`);
                    }

                    // æ›´æ–°é¡µé¢DOM
                    document.getElementById('confirm-count').textContent = confirmCount;
                    document.getElementById('is-authorized').textContent = isAuthorized ? 'âœ… æ˜¯' : 'âŒ å¦';
                    document.getElementById('is-multisigner').textContent = isMultisigner ? 'âœ… æ˜¯' : 'âŒ å¦';

                    // æ›´æ–°å¤šç­¾åœ°å€åˆ—è¡¨
                    const multisigListContainer = document.getElementById('multisig-list');
                    multisigListContainer.innerHTML = '';
                    if (multiSigners.length === 0) {
                        multisigListContainer.innerHTML = '<p class="text-gray-500 text-center">æœªæŸ¥è¯¢åˆ°å¤šç­¾åœ°å€</p>';
                    } else {
                        multiSigners.forEach((addr, index) => {
                            const addrItem = document.createElement('div');
                            addrItem.className = 'p-1 border-b border-gray-100 flex justify-between items-center';
                            addrItem.innerHTML = `
                                <span>${index + 1}. <span class="address-tag">${formatAddress(addr)}</span></span>
                                <span class="font-mono text-xs text-gray-500">${addr}</span>
                            `;
                            multisigListContainer.appendChild(addrItem);
                        });
                    }

                    // å¯ç”¨æ“ä½œæŒ‰é’®ï¼ˆä»…å½“ä¸ºå¤šç­¾è´¦æˆ·æ—¶ï¼‰
                    const confirmBtn = document.getElementById('confirm-modify');
                    const resetBtn = document.getElementById('reset-authorization');
                    if (isMultisigner) {
                        confirmBtn.removeAttribute('disabled');
                        resetBtn.removeAttribute('disabled');
                    } else {
                        confirmBtn.setAttribute('disabled', true);
                        resetBtn.setAttribute('disabled', true);
                    }

                    // æ–°å¢ï¼šæ›´æ–°æƒé™çŠ¶æ€ï¼ˆOwner/Operatorï¼‰
                    await updatePermissionStatus();

                    addLog('å¤šç­¾ä¿¡æ¯æŸ¥è¯¢æˆåŠŸï¼', true);
                } catch (error) {
                    let errorMsg = error.message;
                    addLog(`å¤šç­¾ä¿¡æ¯æŸ¥è¯¢å¤±è´¥ï¼š${errorMsg}`, false);
                    console.error('å¤šç­¾æŸ¥è¯¢é”™è¯¯ï¼š', error);                    } finally {
                        btn.classList.remove('loading');
                        btn.removeAttribute('disabled');
                    }
                });

                // 7. ç¡®è®¤ä¿®æ”¹æˆæƒï¼ˆconfirmModifyï¼‰æ“ä½œ
                document.getElementById('confirm-modify').addEventListener('click', async function() {
                    const btn = this;
                    btn.classList.add('loading');
                    btn.setAttribute('disabled', true);

                    try {
                        if (!web3 || !ammContract || !accounts.length) {
                            throw new Error('è¯·å…ˆè¿æ¥é’±åŒ…å¹¶åˆå§‹åŒ–åˆçº¦');
                        }
                        const currentAccount = accounts[0];
                        const isBSC = await checkBSCNetwork();
                        if (!isBSC) {
                            throw new Error('å½“å‰éBSCä¸»ç½‘ï¼Œæ— æ³•æ‰§è¡Œæ“ä½œ');
                        }

                        addLog(`å¼€å§‹æ‰§è¡Œã€Œç¡®è®¤ä¿®æ”¹æˆæƒã€æ“ä½œï¼Œå½“å‰è´¦æˆ·ï¼š${formatAddress(currentAccount)}`);
                        // è°ƒç”¨åˆçº¦æ–¹æ³•
                        const tx = await ammContract.methods.confirmModify().send({
                            from: currentAccount
                        });

                        addLog(`ç¡®è®¤ä¿®æ”¹æˆæƒæ“ä½œæˆåŠŸï¼äº¤æ˜“å“ˆå¸Œï¼š<span class="address-tag">${tx.transactionHash}</span>`, true);
                        // é‡æ–°æŸ¥è¯¢å¤šç­¾ä¿¡æ¯
                        setTimeout(async () => {
                            await document.getElementById('query-multisig-info').click();
                        }, 2000);
                    } catch (error) {
                        addLog(`ç¡®è®¤ä¿®æ”¹æˆæƒæ“ä½œå¤±è´¥ï¼š${error.message}`, false);
                        console.error('confirmModifyé”™è¯¯ï¼š', error);
                    } finally {
                        btn.classList.remove('loading');
                        btn.removeAttribute('disabled');
                    }
                });

                // 8. é‡ç½®æˆæƒçŠ¶æ€ï¼ˆresetModifyAuthorizationï¼‰æ“ä½œ
                document.getElementById('reset-authorization').addEventListener('click', async function() {
                    const btn = this;
                    btn.classList.add('loading');
                    btn.setAttribute('disabled', true);

                    try {
                        if (!web3 || !ammContract || !accounts.length) {
                            throw new Error('è¯·å…ˆè¿æ¥é’±åŒ…å¹¶åˆå§‹åŒ–åˆçº¦');
                        }
                        const currentAccount = accounts[0];
                        const isBSC = await checkBSCNetwork();
                        if (!isBSC) {
                            throw new Error('å½“å‰éBSCä¸»ç½‘ï¼Œæ— æ³•æ‰§è¡Œæ“ä½œ');
                        }

                        addLog(`å¼€å§‹æ‰§è¡Œã€Œé‡ç½®æˆæƒçŠ¶æ€ã€æ“ä½œï¼Œå½“å‰è´¦æˆ·ï¼š${formatAddress(currentAccount)}`);
                        // è°ƒç”¨åˆçº¦æ–¹æ³•
                        const tx = await ammContract.methods.resetModifyAuthorization().send({
                            from: currentAccount
                        });

                        addLog(`é‡ç½®æˆæƒçŠ¶æ€æ“ä½œæˆåŠŸï¼äº¤æ˜“å“ˆå¸Œï¼š<span class="address-tag">${tx.transactionHash}</span>`, true);
                        // é‡æ–°æŸ¥è¯¢å¤šç­¾ä¿¡æ¯
                        setTimeout(async () => {
                            await document.getElementById('query-multisig-info').click();
                        }, 2000);
                    } catch (error) {
                        addLog(`é‡ç½®æˆæƒçŠ¶æ€æ“ä½œå¤±è´¥ï¼š${error.message}`, false);
                        console.error('resetModifyAuthorizationé”™è¯¯ï¼š', error);
                    } finally {
                        btn.classList.remove('loading');
                        btn.removeAttribute('disabled');
                    }
                });

                // 9. Owneræ“ä½œï¼šè®¾ç½®é…ç½®åœ°å€ï¼ˆsetConfigAddressï¼‰
                document.getElementById('set-config-address').addEventListener('click', async function() {
                    const btn = this;
                    btn.classList.add('loading');
                    btn.setAttribute('disabled', true);

                    try {
                        if (!currentIsOwner) {
                            throw new Error('å½“å‰è´¦æˆ·éåˆçº¦Ownerï¼Œæ— æƒæ‰§è¡Œè¯¥æ“ä½œ');
                        }
                        if (!web3 || !ammContract || !accounts.length) {
                            throw new Error('è¯·å…ˆè¿æ¥é’±åŒ…å¹¶åˆå§‹åŒ–åˆçº¦');
                        }
                        const currentAccount = accounts[0];
                        const isBSC = await checkBSCNetwork();
                        if (!isBSC) {
                            throw new Error('å½“å‰éBSCä¸»ç½‘ï¼Œæ— æ³•æ‰§è¡Œæ“ä½œ');
                        }

                        // è·å–è¾“å…¥å€¼
                        const configType = document.getElementById('config-type').value.trim();
                        const newConfigAddress = document.getElementById('new-config-address').value.trim();

                        // æ ¡éªŒè¾“å…¥
                        if (!configType) {
                            throw new Error('è¯·é€‰æ‹©åœ°å€ç±»å‹');
                        }
                        if (!newConfigAddress || !web3.utils.isAddress(newConfigAddress)) {
                            throw new Error('è¯·è¾“å…¥æœ‰æ•ˆçš„æ–°é…ç½®åœ°å€');
                        }

                        addLog(`å¼€å§‹æ‰§è¡Œã€Œè®¾ç½®é…ç½®åœ°å€ã€æ“ä½œï¼šç±»å‹=${configType}ï¼Œæ–°åœ°å€=${formatAddress(newConfigAddress)}`);
                        // è°ƒç”¨åˆçº¦æ–¹æ³•
                        const tx = await ammContract.methods.setConfigAddress(configType, newConfigAddress).send({
                            from: currentAccount
                        });

                        addLog(`è®¾ç½®é…ç½®åœ°å€æ“ä½œæˆåŠŸï¼äº¤æ˜“å“ˆå¸Œï¼š<span class="address-tag">${tx.transactionHash}</span>`, true);
                    } catch (error) {
                        addLog(`è®¾ç½®é…ç½®åœ°å€æ“ä½œå¤±è´¥ï¼š${error.message}`, false);
                        console.error('setConfigAddressé”™è¯¯ï¼š', error);
                    } finally {
                        btn.classList.remove('loading');
                        btn.removeAttribute('disabled');
                    }
                });

                // 10. Owneræ“ä½œï¼šæ›´æ–°äº¤æ˜“å‚æ•°ï¼ˆupdateTradingParamsï¼‰
                document.getElementById('update-trading-params').addEventListener('click', async function() {
                    const btn = this;
                    btn.classList.add('loading');
                    btn.setAttribute('disabled', true);

                    try {
                        if (!currentIsOwner) {
                            throw new Error('å½“å‰è´¦æˆ·éåˆçº¦Ownerï¼Œæ— æƒæ‰§è¡Œè¯¥æ“ä½œ');
                        }
                        if (!web3 || !ammContract || !accounts.length) {
                            throw new Error('è¯·å…ˆè¿æ¥é’±åŒ…å¹¶åˆå§‹åŒ–åˆçº¦');
                        }
                        const currentAccount = accounts[0];
                        const isBSC = await checkBSCNetwork();
                        if (!isBSC) {
                            throw new Error('å½“å‰éBSCä¸»ç½‘ï¼Œæ— æ³•æ‰§è¡Œæ“ä½œ');
                        }

                        // è·å–è¾“å…¥å€¼
                        const swapSlippage = document.getElementById('swap-slippage').value.trim();
                        const deadlineGap = document.getElementById('deadline-gap').value.trim();

                        // æ ¡éªŒè¾“å…¥
                        if (!swapSlippage || isNaN(swapSlippage) || Number(swapSlippage) < 0 || Number(swapSlippage) > 10000) {
                            throw new Error('è¯·è¾“å…¥0-10000ä¹‹é—´çš„æœ‰æ•ˆæ»‘ç‚¹æ¯”ä¾‹');
                        }
                        if (!deadlineGap || isNaN(deadlineGap) || Number(deadlineGap) < 0 || Number(deadlineGap) > 86400) {
                            throw new Error('è¯·è¾“å…¥0-86400ä¹‹é—´çš„æœ‰æ•ˆæˆªæ­¢æ—¶é—´åç§»');
                        }

                        addLog(`å¼€å§‹æ‰§è¡Œã€Œæ›´æ–°äº¤æ˜“å‚æ•°ã€æ“ä½œï¼šæ»‘ç‚¹=${swapSlippage}ï¼Œæˆªæ­¢åç§»=${deadlineGap}ç§’`);
                        // è°ƒç”¨åˆçº¦æ–¹æ³•
                        const tx = await ammContract.methods.updateTradingParams(
                            web3.utils.toBN(swapSlippage),
                            web3.utils.toBN(deadlineGap)
                        ).send({
                            from: currentAccount
                        });

                        addLog(`æ›´æ–°äº¤æ˜“å‚æ•°æ“ä½œæˆåŠŸï¼äº¤æ˜“å“ˆå¸Œï¼š<span class="address-tag">${tx.transactionHash}</span>`, true);
                    } catch (error) {
                        addLog(`æ›´æ–°äº¤æ˜“å‚æ•°æ“ä½œå¤±è´¥ï¼š${error.message}`, false);
                        console.error('updateTradingParamsé”™è¯¯ï¼š', error);
                    } finally {
                        btn.classList.remove('loading');
                        btn.removeAttribute('disabled');
                    }
                });

                // 11. Owneræ“ä½œï¼šæ·»åŠ Operatorï¼ˆaddOperatorï¼‰
                document.getElementById('add-operator').addEventListener('click', async function() {
                    const btn = this;
                    btn.classList.add('loading');
                    btn.setAttribute('disabled', true);

                    try {
                        if (!currentIsOwner) {
                            throw new Error('å½“å‰è´¦æˆ·éåˆçº¦Ownerï¼Œæ— æƒæ‰§è¡Œè¯¥æ“ä½œ');
                        }
                        if (!web3 || !ammContract || !accounts.length) {
                            throw new Error('è¯·å…ˆè¿æ¥é’±åŒ…å¹¶åˆå§‹åŒ–åˆçº¦');
                        }
                        const currentAccount = accounts[0];
                        const isBSC = await checkBSCNetwork();
                        if (!isBSC) {
                            throw new Error('å½“å‰éBSCä¸»ç½‘ï¼Œæ— æ³•æ‰§è¡Œæ“ä½œ');
                        }

                        // è·å–è¾“å…¥å€¼
                        const operatorAddress = document.getElementById('operator-address').value.trim();
                        const maxSwapAmount = document.getElementById('max-swap-amount').value.trim();
                        const maxAddLiqToken = document.getElementById('max-add-liq-token').value.trim();
                        const maxAddLiqUsdt = document.getElementById('max-add-liq-usdt').value.trim();
                        const maxRemoveLiq = document.getElementById('max-remove-liq').value.trim();

                        // æ ¡éªŒè¾“å…¥
                        if (!operatorAddress || !web3.utils.isAddress(operatorAddress)) {
                            throw new Error('è¯·è¾“å…¥æœ‰æ•ˆçš„Operatoråœ°å€');
                        }
                        if (!maxSwapAmount || isNaN(maxSwapAmount) || Number(maxSwapAmount) < 0) {
                            throw new Error('è¯·è¾“å…¥éè´Ÿçš„æœ‰æ•ˆæœ€å¤§Swapé‡‘é¢');
                        }
                        if (!maxAddLiqToken || isNaN(maxAddLiqToken) || Number(maxAddLiqToken) < 0) {
                            throw new Error('è¯·è¾“å…¥éè´Ÿçš„æœ‰æ•ˆæœ€å¤§æ·»åŠ æµåŠ¨æ€§Tokené‡‘é¢');
                        }
                        if (!maxAddLiqUsdt || isNaN(maxAddLiqUsdt) || Number(maxAddLiqUsdt) < 0) {
                            throw new Error('è¯·è¾“å…¥éè´Ÿçš„æœ‰æ•ˆæœ€å¤§æ·»åŠ æµåŠ¨æ€§USDTé‡‘é¢');
                        }
                        if (!maxRemoveLiq || isNaN(maxRemoveLiq) || Number(maxRemoveLiq) < 0) {
                            throw new Error('è¯·è¾“å…¥éè´Ÿçš„æœ‰æ•ˆæœ€å¤§ç§»é™¤æµåŠ¨æ€§é‡‘é¢');
                        }

                        addLog(`å¼€å§‹æ‰§è¡Œã€Œæ·»åŠ Operatorã€æ“ä½œï¼šåœ°å€=${formatAddress(operatorAddress)}`);
                        // è°ƒç”¨åˆçº¦æ–¹æ³•
                        const tx = await ammContract.methods.addOperator(
                            operatorAddress,
                            web3.utils.toBN(maxSwapAmount),
                            web3.utils.toBN(maxAddLiqToken),
                            web3.utils.toBN(maxAddLiqUsdt),
                            web3.utils.toBN(maxRemoveLiq)
                        ).send({
                            from: currentAccount
                        });

                        addLog(`æ·»åŠ Operatoræ“ä½œæˆåŠŸï¼äº¤æ˜“å“ˆå¸Œï¼š<span class="address-tag">${tx.transactionHash}</span>`, true);
                    } catch (error) {
                        addLog(`æ·»åŠ Operatoræ“ä½œå¤±è´¥ï¼š${error.message}`, false);
                        console.error('addOperatoré”™è¯¯ï¼š', error);
                    } finally {
                        btn.classList.remove('loading');
                        btn.removeAttribute('disabled');
                    }
                });

                // 12. Owneræ“ä½œï¼šç§»é™¤Operatorï¼ˆremoveOperatorï¼‰
                document.getElementById('remove-operator').addEventListener('click', async function() {
                    const btn = this;
                    btn.classList.add('loading');
                    btn.setAttribute('disabled', true);

                    try {
                        if (!currentIsOwner) {
                            throw new Error('å½“å‰è´¦æˆ·éåˆçº¦Ownerï¼Œæ— æƒæ‰§è¡Œè¯¥æ“ä½œ');
                        }
                        if (!web3 || !ammContract || !accounts.length) {
                            throw new Error('è¯·å…ˆè¿æ¥é’±åŒ…å¹¶åˆå§‹åŒ–åˆçº¦');
                        }
                        const currentAccount = accounts[0];
                        const isBSC = await checkBSCNetwork();
                        if (!isBSC) {
                            throw new Error('å½“å‰éBSCä¸»ç½‘ï¼Œæ— æ³•æ‰§è¡Œæ“ä½œ');
                        }

                        // è·å–è¾“å…¥å€¼
                        const operatorAddress = document.getElementById('remove-operator-address').value.trim();

                        // æ ¡éªŒè¾“å…¥
                        if (!operatorAddress || !web3.utils.isAddress(operatorAddress)) {
                            throw new Error('è¯·è¾“å…¥æœ‰æ•ˆçš„Operatoråœ°å€');
                        }

                        addLog(`å¼€å§‹æ‰§è¡Œã€Œç§»é™¤Operatorã€æ“ä½œï¼šåœ°å€=${formatAddress(operatorAddress)}`);
                        // è°ƒç”¨åˆçº¦æ–¹æ³•
                        const tx = await ammContract.methods.removeOperator(operatorAddress).send({
                            from: currentAccount
                        });

                        addLog(`ç§»é™¤Operatoræ“ä½œæˆåŠŸï¼äº¤æ˜“å“ˆå¸Œï¼š<span class="address-tag">${tx.transactionHash}</span>`, true);
                    } catch (error) {
                        addLog(`ç§»é™¤Operatoræ“ä½œå¤±è´¥ï¼š${error.message}`, false);
                        console.error('removeOperatoré”™è¯¯ï¼š', error);
                    } finally {
                        btn.classList.remove('loading');
                        btn.removeAttribute('disabled');
                    }
                });

                // 13. Owneræ“ä½œï¼šè®¾ç½®Operatoré™é¢ï¼ˆsetOperatorLimitsï¼‰
                document.getElementById('set-operator-limits').addEventListener('click', async function() {
                    const btn = this;
                    btn.classList.add('loading');
                    btn.setAttribute('disabled', true);

                    try {
                        if (!currentIsOwner) {
                            throw new Error('å½“å‰è´¦æˆ·éåˆçº¦Ownerï¼Œæ— æƒæ‰§è¡Œè¯¥æ“ä½œ');
                        }
                        if (!web3 || !ammContract || !accounts.length) {
                            throw new Error('è¯·å…ˆè¿æ¥é’±åŒ…å¹¶åˆå§‹åŒ–åˆçº¦');
                        }
                        const currentAccount = accounts[0];
                        const isBSC = await checkBSCNetwork();
                        if (!isBSC) {
                            throw new Error('å½“å‰éBSCä¸»ç½‘ï¼Œæ— æ³•æ‰§è¡Œæ“ä½œ');
                        }

                        // è·å–è¾“å…¥å€¼
                        const operatorAddress = document.getElementById('set-limits-operator-address').value.trim();
                        const newMaxSwap = document.getElementById('new-max-swap').value.trim();
                        const newMaxAddLiqToken = document.getElementById('new-max-add-liq-token').value.trim();
                        const newMaxAddLiqUsdt = document.getElementById('new-max-add-liq-usdt').value.trim();
                        const newMaxRemoveLiq = document.getElementById('new-max-remove-liq').value.trim();
                        const isActive = (document.getElementById('operator-is-active').value === 'true');

                        // æ ¡éªŒè¾“å…¥
                        if (!operatorAddress || !web3.utils.isAddress(operatorAddress)) {
                            throw new Error('è¯·è¾“å…¥æœ‰æ•ˆçš„Operatoråœ°å€');
                        }
                        if (!newMaxSwap || isNaN(newMaxSwap) || Number(newMaxSwap) < 0) {
                            throw new Error('è¯·è¾“å…¥éè´Ÿçš„æœ‰æ•ˆæ–°æœ€å¤§Swapé‡‘é¢');
                        }
                        if (!newMaxAddLiqToken || isNaN(newMaxAddLiqToken) || Number(newMaxAddLiqToken) < 0) {
                            throw new Error('è¯·è¾“å…¥éè´Ÿçš„æœ‰æ•ˆæ–°æœ€å¤§æ·»åŠ æµåŠ¨æ€§Tokené‡‘é¢');
                        }
                        if (!newMaxAddLiqUsdt || isNaN(newMaxAddLiqUsdt) || Number(newMaxAddLiqUsdt) < 0) {
                            throw new Error('è¯·è¾“å…¥éè´Ÿçš„æœ‰æ•ˆæ–°æœ€å¤§æ·»åŠ æµåŠ¨æ€§USDTé‡‘é¢');
                        }
                        if (!newMaxRemoveLiq || isNaN(newMaxRemoveLiq) || Number(newMaxRemoveLiq) < 0) {
                            throw new Error('è¯·è¾“å…¥éè´Ÿçš„æœ‰æ•ˆæ–°æœ€å¤§ç§»é™¤æµåŠ¨æ€§é‡‘é¢');
                        }

                        addLog(`å¼€å§‹æ‰§è¡Œã€Œè®¾ç½®Operatoré™é¢ã€æ“ä½œï¼šåœ°å€=${formatAddress(operatorAddress)}ï¼Œæ˜¯å¦æ¿€æ´»=${isActive}`);
                        // è°ƒç”¨åˆçº¦æ–¹æ³•
                        const tx = await ammContract.methods.setOperatorLimits(
                            operatorAddress,
                            web3.utils.toBN(newMaxSwap),
                            web3.utils.toBN(newMaxAddLiqToken),
                            web3.utils.toBN(newMaxAddLiqUsdt),
                            web3.utils.toBN(newMaxRemoveLiq),
                            isActive
                        ).send({
                            from: currentAccount
                        });

                        addLog(`è®¾ç½®Operatoré™é¢æ“ä½œæˆåŠŸï¼äº¤æ˜“å“ˆå¸Œï¼š<span class="address-tag">${tx.transactionHash}</span>`, true);
                    } catch (error) {
                        addLog(`è®¾ç½®Operatoré™é¢æ“ä½œå¤±è´¥ï¼š${error.message}`, false);
                        console.error('setOperatorLimitsé”™è¯¯ï¼š', error);
                    } finally {
                        btn.classList.remove('loading');
                        btn.removeAttribute('disabled');
                    }
                });

                // 14. Operatoræ“ä½œï¼šè‡ªåŠ¨å…‘æ¢ï¼ˆautoSwapï¼‰
                document.getElementById('auto-swap').addEventListener('click', async function() {
                    const btn = this;
                    btn.classList.add('loading');
                    btn.setAttribute('disabled', true);

                    try {
                        if (!currentIsActiveOperator) {
                            throw new Error('å½“å‰è´¦æˆ·éæ´»è·ƒOperatorï¼Œæ— æƒæ‰§è¡Œè¯¥æ“ä½œ');
                        }
                        if (!web3 || !ammContract || !accounts.length) {
                            throw new Error('è¯·å…ˆè¿æ¥é’±åŒ…å¹¶åˆå§‹åŒ–åˆçº¦');
                        }
                        const currentAccount = accounts[0];
                        const isBSC = await checkBSCNetwork();
                        if (!isBSC) {
                            throw new Error('å½“å‰éBSCä¸»ç½‘ï¼Œæ— æ³•æ‰§è¡Œæ“ä½œ');
                        }

                        // è·å–è¾“å…¥å€¼
                        const fromToken = document.getElementById('from-token').value.trim();
                        const toToken = document.getElementById('to-token').value.trim();
                        const swapAmountIn = document.getElementById('swap-amount-in').value.trim();
                        let swapAmountOutMin = document.getElementById('swap-amount-out-min').value.trim();

                        // æ ¡éªŒè¾“å…¥
                        if (!fromToken || !web3.utils.isAddress(fromToken)) {
                            throw new Error('è¯·è¾“å…¥æœ‰æ•ˆçš„è½¬å‡ºä»£å¸åœ°å€');
                        }
                        if (!toToken || !web3.utils.isAddress(toToken)) {
                            throw new Error('è¯·è¾“å…¥æœ‰æ•ˆçš„è½¬å…¥ä»£å¸åœ°å€');
                        }
                        if (!swapAmountIn || isNaN(swapAmountIn) || Number(swapAmountIn) < 0) {
                            throw new Error('è¯·è¾“å…¥éè´Ÿçš„æœ‰æ•ˆè½¬å‡ºé‡‘é¢');
                        }
                        if (!swapAmountOutMin) {
                            swapAmountOutMin = '0';
                        } else if (isNaN(swapAmountOutMin) || Number(swapAmountOutMin) < 0) {
                            throw new Error('è¯·è¾“å…¥éè´Ÿçš„æœ‰æ•ˆæœ€å°è½¬å…¥é‡‘é¢');
                        }

                        addLog(`å¼€å§‹æ‰§è¡Œã€Œè‡ªåŠ¨å…‘æ¢ã€æ“ä½œï¼šä»${formatAddress(fromToken)}åˆ°${formatAddress(toToken)}ï¼Œè½¬å‡ºé‡‘é¢=${swapAmountIn}`);
                        // è°ƒç”¨åˆçº¦æ–¹æ³•
                        const tx = await ammContract.methods.autoSwap(
                            fromToken,
                            toToken,
                            web3.utils.toBN(swapAmountIn),
                            web3.utils.toBN(swapAmountOutMin)
                        ).send({
                            from: currentAccount
                        });

                        addLog(`è‡ªåŠ¨å…‘æ¢æ“ä½œæˆåŠŸï¼äº¤æ˜“å“ˆå¸Œï¼š<span class="address-tag">${tx.transactionHash}</span>`, true);
                    } catch (error) {
                        addLog(`è‡ªåŠ¨å…‘æ¢æ“ä½œå¤±è´¥ï¼š${error.message}`, false);
                        console.error('autoSwapé”™è¯¯ï¼š', error);
                    } finally {
                        btn.classList.remove('loading');
                        btn.removeAttribute('disabled');
                    }
                });

                // 15. Operatoræ“ä½œï¼šè‡ªåŠ¨æ·»åŠ æµåŠ¨æ€§ï¼ˆautoAddLiquidityï¼‰
                document.getElementById('auto-add-liquidity').addEventListener('click', async function() {
                    const btn = this;
                    btn.classList.add('loading');
                    btn.setAttribute('disabled', true);

                    try {
                        if (!currentIsActiveOperator) {
                            throw new Error('å½“å‰è´¦æˆ·éæ´»è·ƒOperatorï¼Œæ— æƒæ‰§è¡Œè¯¥æ“ä½œ');
                        }
                        if (!web3 || !ammContract || !accounts.length) {
                            throw new Error('è¯·å…ˆè¿æ¥é’±åŒ…å¹¶åˆå§‹åŒ–åˆçº¦');
                        }
                        const currentAccount = accounts[0];
                        const isBSC = await checkBSCNetwork();
                        if (!isBSC) {
                            throw new Error('å½“å‰éBSCä¸»ç½‘ï¼Œæ— æ³•æ‰§è¡Œæ“ä½œ');
                        }

                        // è·å–è¾“å…¥å€¼
                        const liqTokenAmount = document.getElementById('liq-token-amount').value.trim();
                        const liqUsdtAmount = document.getElementById('liq-usdt-amount').value.trim();
                        let liqTokenMin = document.getElementById('liq-token-min').value.trim();
                        let liqUsdtMin = document.getElementById('liq-usdt-min').value.trim();

                        // æ ¡éªŒè¾“å…¥
                        if (!liqTokenAmount || isNaN(liqTokenAmount) || Number(liqTokenAmount) < 0) {
                            throw new Error('è¯·è¾“å…¥éè´Ÿçš„æœ‰æ•ˆTokenæœŸæœ›é‡‘é¢');
                        }
                        if (!liqUsdtAmount || isNaN(liqUsdtAmount) || Number(liqUsdtAmount) < 0) {
                            throw new Error('è¯·è¾“å…¥éè´Ÿçš„æœ‰æ•ˆUSDTæœŸæœ›é‡‘é¢');
                        }
                        if (!liqTokenMin) {
                            liqTokenMin = '0';
                        } else if (isNaN(liqTokenMin) || Number(liqTokenMin) < 0) {
                            throw new Error('è¯·è¾“å…¥éè´Ÿçš„æœ‰æ•ˆTokenæœ€å°é‡‘é¢');
                        }
                        if (!liqUsdtMin) {
                            liqUsdtMin = '0';
                        } else if (isNaN(liqUsdtMin) || Number(liqUsdtMin) < 0) {
                            throw new Error('è¯·è¾“å…¥éè´Ÿçš„æœ‰æ•ˆUSDTæœ€å°é‡‘é¢');
                        }

                        addLog(`å¼€å§‹æ‰§è¡Œã€Œè‡ªåŠ¨æ·»åŠ æµåŠ¨æ€§ã€æ“ä½œï¼šTokené‡‘é¢=${liqTokenAmount}ï¼ŒUSDTé‡‘é¢=${liqUsdtAmount}`);
                        // è°ƒç”¨åˆçº¦æ–¹æ³•
                        const tx = await ammContract.methods.autoAddLiquidity(
                            web3.utils.toBN(liqTokenAmount),
                            web3.utils.toBN(liqUsdtAmount),
                            web3.utils.toBN(liqTokenMin),
                            web3.utils.toBN(liqUsdtMin)
                        ).send({
                            from: currentAccount
                        });

                        addLog(`è‡ªåŠ¨æ·»åŠ æµåŠ¨æ€§æ“ä½œæˆåŠŸï¼äº¤æ˜“å“ˆå¸Œï¼š<span class="address-tag">${tx.transactionHash}</span>`, true);
                    } catch (error) {
                        addLog(`è‡ªåŠ¨æ·»åŠ æµåŠ¨æ€§æ“ä½œå¤±è´¥ï¼š${error.message}`, false);
                        console.error('autoAddLiquidityé”™è¯¯ï¼š', error);
                    } finally {
                        btn.classList.remove('loading');
                        btn.removeAttribute('disabled');
                    }
                });

                // 16. Operatoræ“ä½œï¼šè‡ªåŠ¨ç§»é™¤æµåŠ¨æ€§ï¼ˆautoRemoveLiquidityï¼‰
                document.getElementById('auto-remove-liquidity').addEventListener('click', async function() {
                    const btn = this;
                    btn.classList.add('loading');
                    btn.setAttribute('disabled', true);

                    try {
                        if (!currentIsActiveOperator) {
                            throw new Error('å½“å‰è´¦æˆ·éæ´»è·ƒOperatorï¼Œæ— æƒæ‰§è¡Œè¯¥æ“ä½œ');
                        }
                        if (!web3 || !ammContract || !accounts.length) {
                            throw new Error('è¯·å…ˆè¿æ¥é’±åŒ…å¹¶åˆå§‹åŒ–åˆçº¦');
                        }
                        const currentAccount = accounts[0];
                        const isBSC = await checkBSCNetwork();
                        if (!isBSC) {
                            throw new Error('å½“å‰éBSCä¸»ç½‘ï¼Œæ— æ³•æ‰§è¡Œæ“ä½œ');
                        }

                        // è·å–è¾“å…¥å€¼
                        const removeLiqAmount = document.getElementById('remove-liq-amount').value.trim();
                        let removeTokenMin = document.getElementById('remove-token-min').value.trim();
                        let removeUsdtMin = document.getElementById('remove-usdt-min').value.trim();

                        // æ ¡éªŒè¾“å…¥
                        if (!removeLiqAmount || isNaN(removeLiqAmount) || Number(removeLiqAmount) < 0) {
                            throw new Error('è¯·è¾“å…¥éè´Ÿçš„æœ‰æ•ˆLPä»£å¸é‡‘é¢');
                        }
                        if (!removeTokenMin) {
                            removeTokenMin = '1';
                        } else if (isNaN(removeTokenMin) || Number(removeTokenMin) < 0) {
                            throw new Error('è¯·è¾“å…¥éè´Ÿçš„æœ‰æ•ˆTokenæœ€å°é‡‘é¢');
                        }
                        if (!removeUsdtMin) {
                            removeUsdtMin = '1';
                        } else if (isNaN(removeUsdtMin) || Number(removeUsdtMin) < 0) {
                            throw new Error('è¯·è¾“å…¥éè´Ÿçš„æœ‰æ•ˆUSDTæœ€å°é‡‘é¢');
                        }

                        addLog(`å¼€å§‹æ‰§è¡Œã€Œè‡ªåŠ¨ç§»é™¤æµåŠ¨æ€§ã€æ“ä½œï¼šLPä»£å¸é‡‘é¢=${removeLiqAmount}`);
                        // è°ƒç”¨åˆçº¦æ–¹æ³•
                        const tx = await ammContract.methods.autoRemoveLiquidity(
                            web3.utils.toBN(removeLiqAmount),
                            web3.utils.toBN(removeTokenMin),
                            web3.utils.toBN(removeUsdtMin)
                        ).send({
                            from: currentAccount
                        });

                        addLog(`è‡ªåŠ¨ç§»é™¤æµåŠ¨æ€§æ“ä½œæˆåŠŸï¼äº¤æ˜“å“ˆå¸Œï¼š<span class="address-tag">${tx.transactionHash}</span>`, true);
                    } catch (error) {
                        addLog(`è‡ªåŠ¨ç§»é™¤æµåŠ¨æ€§æ“ä½œå¤±è´¥ï¼š${error.message}`, false);
                        console.error('autoRemoveLiquidityé”™è¯¯ï¼š', error);
                    } finally {
                        btn.classList.remove('loading');
                        btn.removeAttribute('disabled');
                    }
                });

                // 17. Operatoræ“ä½œï¼šè½¬è´¦èµ„é‡‘ï¼ˆtransferFundsï¼‰
                document.getElementById('transfer-funds').addEventListener('click', async function() {
                    const btn = this;
                    btn.classList.add('loading');
                    btn.setAttribute('disabled', true);

                    try {
                        if (!currentIsActiveOperator) {
                            throw new Error('å½“å‰è´¦æˆ·éæ´»è·ƒOperatorï¼Œæ— æƒæ‰§è¡Œè¯¥æ“ä½œ');
                        }
                        if (!web3 || !ammContract || !accounts.length) {
                            throw new Error('è¯·å…ˆè¿æ¥é’±åŒ…å¹¶åˆå§‹åŒ–åˆçº¦');
                        }
                        const currentAccount = accounts[0];
                        const isBSC = await checkBSCNetwork();
                        if (!isBSC) {
                            throw new Error('å½“å‰éBSCä¸»ç½‘ï¼Œæ— æ³•æ‰§è¡Œæ“ä½œ');
                        }

                        // è·å–è¾“å…¥å€¼
                        const transferToken = document.getElementById('transfer-token').value.trim();
                        const transferRecipient = document.getElementById('transfer-recipient').value.trim();
                        const transferAmount = document.getElementById('transfer-amount').value.trim();

                        // æ ¡éªŒè¾“å…¥
                        if (!transferToken || !web3.utils.isAddress(transferToken)) {
                            throw new Error('è¯·è¾“å…¥æœ‰æ•ˆçš„ä»£å¸åœ°å€');
                        }
                        if (!transferRecipient || !web3.utils.isAddress(transferRecipient)) {
                            throw new Error('è¯·è¾“å…¥æœ‰æ•ˆçš„æ¥æ”¶åœ°å€');
                        }
                        if (!transferAmount || isNaN(transferAmount) || Number(transferAmount) < 0) {
                            throw new Error('è¯·è¾“å…¥éè´Ÿçš„æœ‰æ•ˆè½¬è´¦é‡‘é¢');
                        }

                        addLog(`å¼€å§‹æ‰§è¡Œã€Œè½¬è´¦èµ„é‡‘ã€æ“ä½œï¼šä»£å¸=${formatAddress(transferToken)}ï¼Œæ¥æ”¶åœ°å€=${formatAddress(transferRecipient)}ï¼Œé‡‘é¢=${transferAmount}`);
                        // è°ƒç”¨åˆçº¦æ–¹æ³•
                        const tx = await ammContract.methods.transferFunds(
                            transferToken,
                            transferRecipient,
                            web3.utils.toBN(transferAmount)
                        ).send({
                            from: currentAccount
                        });

                        addLog(`è½¬è´¦èµ„é‡‘æ“ä½œæˆåŠŸï¼äº¤æ˜“å“ˆå¸Œï¼š<span class="address-tag">${tx.transactionHash}</span>`, true);
                        // é‡æ–°æŸ¥è¯¢ä»£å¸ä½™é¢
                        setTimeout(async () => {
                            await queryContractTokenBalance();
                        }, 2000);
                    } catch (error) {
                        addLog(`è½¬è´¦èµ„é‡‘æ“ä½œå¤±è´¥ï¼š${error.message}`, false);
                        console.error('transferFundsé”™è¯¯ï¼š', error);
                    } finally {
                        btn.classList.remove('loading');
                        btn.removeAttribute('disabled');
                    }
                });

                // 18. ç»‘å®šä»£å¸åœ°å€è¾“å…¥äº‹ä»¶ï¼Œè‡ªåŠ¨æŸ¥è¯¢åˆçº¦ä½™é¢
                document.getElementById('transfer-token').addEventListener('blur', async function() {
                    await queryContractTokenBalance();
                });
                document.getElementById('transfer-token').addEventListener('input', async function() {
                    // è¾“å…¥åœæ­¢åå»¶è¿ŸæŸ¥è¯¢ï¼Œé¿å…é¢‘ç¹è¯·æ±‚
                    clearTimeout(this.balanceQueryTimer);
                    this.balanceQueryTimer = setTimeout(async () => {
                        await queryContractTokenBalance();
                    }, 500);
                });

                addLog('æ‰€æœ‰äº‹ä»¶ç»‘å®šå®Œæˆï¼Œé¡µé¢åˆå§‹åŒ–å°±ç»ª', true);
            });
        </script>
    </body>
</html>
